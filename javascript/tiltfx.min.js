!function(t){"use strict";for(var e,i=0,o="webkit moz ms o".split(" "),s=t.requestAnimationFrame,n=t.cancelAnimationFrame,a=0;a<o.length&&(!s||!n);a++)e=o[a],s=s||t[e+"RequestAnimationFrame"],n=n||t[e+"CancelAnimationFrame"]||t[e+"CancelRequestAnimationFrame"];function r(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}function m(t,e){t&&(this.el=t,this.options=r({},this.options),r(this.options,e),this._init(),this._initEvents())}s&&n||(s=function(e,o){var s=(new Date).getTime(),n=Math.max(0,16-(s-i)),a=t.setTimeout(function(){e(s+n)},n);return i=s+n,a},n=function(e){t.clearTimeout(e)}),m.prototype.options={extraImgs:2,extraImgsScaleGrade:0,opacity:.7,customImgsOpacity:!1,bgfixed:!0,resetOnLeave:!0,movement:{perspective:1e3,translateX:-10,translateY:-10,translateZ:20,rotateX:2,rotateY:2,rotateZ:0},element:{mouseMoveWatcher:null,viewWatcher:null}},m.prototype._init=function(){this.tiltWrapper=document.createElement("div"),this.tiltWrapper.className="tilt",this.tiltImgBack=document.createElement("div"),this.tiltImgBack.className="tilt__back",this.tiltImgBack.tiltFxType="back",this.tiltImgBack.style.backgroundImage="url("+this.el.src+")",this.tiltWrapper.appendChild(this.tiltImgBack),this.options.extraImgs<1?this.imgCount=0:this.options.extraImgs>64?this.imgCount=64:this.imgCount=this.options.extraImgs,this.options.movement.perspective||(this.options.movement.perspective=0),this.imgElems=[];var t=this.imgCount;this.options.customImgsOpacity;this.options.bgfixed||(this.imgElems.push(this.tiltImgBack),++this.imgCount);for(var e=0;e<t;++e){var i=document.createElement("div");i.className="tilt__front",i.style.backgroundImage="url("+this.el.src+")",this.tiltWrapper.appendChild(i),this.imgElems.push(i)}this._initSetImagesOpacity(),this.el.parentNode.insertBefore(this.tiltWrapper,this.el),this.el.parentNode.removeChild(this.el),this._setViewWatcher(this),this._setMouseMoveWatcher(this),this._calcView(this)},m.prototype._initSetImagesOpacity=function(){if(this.options.customImgsOpacity)for(var t=0,e=this.imgElems.length;t<e;++t){var i=this.options.customImgsOpacity[t]?this.options.customImgsOpacity[t]:this.options.opacity;this.imgElems[t].style.opacity=i}else for(t=0,e=this.imgElems.length;t<e;++t)"back"!==this.imgElems[t].tiltFxType&&(this.imgElems[t].style.opacity=this.options.opacity)},m.prototype._calcView=function(t){t.view={width:t.viewWatcher.offsetWidth,height:t.viewWatcher.offsetHeight}},m.prototype._setMouseMoveWatcher=function(t){var e=!1;if(t.options.element&&t.options.element.mouseMoveWatcher){var i=document.querySelector(t.options.element.mouseMoveWatcher);t.mouseMoveWatcher=i,e=!0}e||(t.mouseMoveWatcher=t.viewWatcher)},m.prototype._setViewWatcher=function(t){var e=!1;if(t.options.element&&t.options.element.viewWatcher){var i=document.querySelector(t.options.element.viewWatcher);i&&(t.viewWatcher=i,e=!0)}e||(t.viewWatcher=t.tiltWrapper)},m.prototype._initEvents=function(){var e,i,o,n=this,a=n.options.movement;n.mouseMoveWatcher.addEventListener("mousemove",function(e){s(function(){for(var i=function(e){var i=0,o=0;e||(e=t.event);return e.pageX||e.pageY?(i=e.pageX,o=e.pageY):(e.clientX||e.clientY)&&(i=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,o=e.clientY+document.body.scrollTop+document.documentElement.scrollTop),{x:i,y:o}}(e),o=document.body.scrollLeft+document.documentElement.scrollLeft,s=document.body.scrollTop+document.documentElement.scrollTop,r=n.tiltWrapper.getBoundingClientRect(),m=i.x-r.left-o,c=i.y-r.top-s,l=0,p=n.imgElems.length;l<p;++l){var h=n.imgElems[l],u=a.rotateX?(l+1)*a.rotateX/n.imgCount*2/n.view.height*c-(l+1)*a.rotateX/n.imgCount:0,g=a.rotateY?(l+1)*a.rotateY/n.imgCount*2/n.view.width*m-(l+1)*a.rotateY/n.imgCount:0,d=a.rotateZ?(l+1)*a.rotateZ/n.imgCount*2/n.view.width*m-(l+1)*a.rotateZ/n.imgCount:0,v=a.translateX?(l+1)*a.translateX/n.imgCount*2/n.view.width*m-(l+1)*a.translateX/n.imgCount:0,f=a.translateY?(l+1)*a.translateY/n.imgCount*2/n.view.height*c-(l+1)*a.translateY/n.imgCount:0,y=a.translateZ?(l+1)*a.translateZ/n.imgCount*2/n.view.height*c-(l+1)*a.translateZ/n.imgCount:0,w=1+n.options.extraImgsScaleGrade*(p-(l+1)),W=1!==w?" scale("+w+", "+w+")":"";h.style.WebkitTransform="perspective("+a.perspective+"px) translate3d("+v+"px,"+f+"px,"+y+"px) rotate3d(1,0,0,"+u+"deg) rotate3d(0,1,0,"+g+"deg) rotate3d(0,0,1,"+d+"deg)"+W,h.style.transform="perspective("+a.perspective+"px) translate3d("+v+"px,"+f+"px,"+y+"px) rotate3d(1,0,0,"+u+"deg) rotate3d(0,1,0,"+g+"deg) rotate3d(0,0,1,"+d+"deg)"+W}})}),n.options.resetOnLeave&&n.mouseMoveWatcher.addEventListener("mouseleave",function(){setTimeout(function(){for(var t=0,e=n.imgElems.length;t<e;++t){var i=n.imgElems[t];i.style.WebkitTransform="perspective("+a.perspective+"px) translate3d(0,0,0) rotate3d(1,1,1,0deg)",i.style.transform="perspective("+a.perspective+"px) translate3d(0,0,0) rotate3d(1,1,1,0deg)"}},60)}),t.addEventListener("resize",(e=function(){n._calcView(n)},i=50,o=!0,function(t){o&&(o=!1,setTimeout(function(){o=!0},i),e(t))}))},m.prototype.init=function(){[].slice.call(document.querySelectorAll("img.tilt-effect")).forEach(function(t){new m(t,JSON.parse(t.getAttribute("data-tilt-options")))})},(new m).init(),t.TiltFx=m}(window);